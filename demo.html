<! DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Demo</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.44.0/mapbox-gl.css' rel='stylesheet' />
    <link href="style.css" rel="stylesheet" />
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.44.0/mapbox-gl.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
    <script src="Highmaps-6/code/highcharts.js"></script>
    <script src='Highmaps-6/code/js/modules/map.js'></script>
    <script src="Highmaps-6/code/modules/data.js"></script>
    <script src="https://code.highcharts.com/mapdata/countries/us/us-all.js"></script>
    <script src='jquery-3.3.1.js'></script>
</head>

<body style="background-color: #f6f6f6;">

    <div id="searchBar" class="fixed">
        <p style="padding-left: 15px; margin-top: 13px;">Peet's Coffee and Tea</p>
    </div>
    <div id="dateBar" class="fixed">
        <p style="padding-left: 15px; margin-top: 13px;">Past 5 minutes</p>
    </div>

    <div id="container" class="fixed">
        <div id="tabs" class="fixed">
            <a href="index.html"><h2 style="margin-right: 10px;" class="inline">Footfall</h2></a>
            <a href="behavior.html"><h2 style="margin-right: 10px;"  class="inline">Behavior</h2></a>
            <a href="demo.html" class="active"><h2 style="margin-right: 10px;"  class="inline">Demographics</h2></a>
            <a href="user.html"><h2 style="margin-right: 10px;"  class="inline">User Journey</h2></a>
        </div>

        <div id='map' class="fixed"></div>

        <div id='ageDiv' class="fixed leftChart">
            <h3>Visitor Age</h3>
            <canvas id="age" width="400" height="200"></canvas>
        </div>

        <div id='incomeDiv' class="fixed leftChart">
            <h3>Visitor Income</h3>
            <canvas id="income" width="400" height="400"></canvas>
        </div>

        <div id='homeRegionDiv' class="fixed" style="width: 800px; height: 420px;">
            <h3>Home Regions More Likely to Visit</h3>
            <canvas id="homeRegion" width="1200" height="420"></canvas>
        </div>

    </div>


    <script>
        //Highmap
        $.getJSON('home-region-arbys.json', function(data) {

            // Make codes uppercase to match the map data
            $.each(data, function() {
                this.code = this.code.toUpperCase();
            });

            // Instantiate the map
            Highcharts.mapChart('map', {

                chart: {
                    map: 'countries/us/us-all',
                    borderWidth: 1
                },

                title: {
                    text: 'Top Home Regions'
                },

                exporting: {
                    sourceWidth: 600,
                    sourceHeight: 500
                },


                mapNavigation: {
                    enabled: true
                },

                colorAxis: {
                    min: 5000,
                    type: 'logarithmic',
                    minColor: '#FFF0E0',
                    maxColor: '#FB8D2B',
                    stops: [
                        [0, 'rgba(237, 115, 18, 0.2)'],
                        [0.67, 'rgba(237, 115, 18, 0.7)'],
                        [1, 'rgba(237, 115, 18, 1)']
                    ]
                },

                series: [{
                    animation: {
                        duration: 1000
                    },
                    data: data,
                    joinBy: ['postal-code', 'code'],
                    dataLabels: {
                        enabled: true,
                        color: '#333',
                        format: '{point.code}'
                    },
                    name: 'Visitors from this region',
                    tooltip: {
                        pointFormat: '{point.code}: {point.value}'
                    }
                }]
            });
        });
        //Visitor Age
        var a = document.getElementById("age").getContext('2d');
        var age = new Chart(a, {
            type: 'doughnut',
            data: {
                labels: ["18-24", "25-34", "35-44", "45-54", "55-64", "66+"],
                datasets: [{
                    data: [229410, 690332, 1098293, 408653, 52207, 24934],
                    backgroundColor: ['RGBA(251, 141, 43, .8)', 'RGBA(64, 133, 232, .8)', 'RGBA(108, 202, 213, .8)', 'RGBA(250, 82, 81, .8)', 'RGBA(103, 103, 241, .8)', 'RGBA(176, 116, 175, .8)', ],
                    borderColor: ['RGBA(251, 141, 43, 1.00)', 'RGBA(64, 133, 232, 1.00)', 'RGBA(108, 202, 213, 1.00)', 'RGBA(250, 82, 81, 1.00)', 'RGBA(103, 103, 241, 1.00)', 'RGBA(176, 116, 175, 1.00)', ],
                    borderWidth: 2
                }, ]
            },
            options: {

                legend: {
                    display: true,
                    position: 'right',
                },
            }
        });


        //Visitor Income
        var inc = document.getElementById("income").getContext('2d');
        var income = new Chart(inc, {
            type: 'horizontalBar',
            data: {
                labels: ["$0-25k", "$25-50k", "$50-75k", "$75-100k", "$100-125k", "$125-150k", "$150-175k", "$175-200k", "$200-225k"],
                datasets: [{
                    label: 'Arby\'s',
                    data: [132530 / 2333361 * 100, 870139 / 2333361 * 100, 803917 / 2333361 * 100, 339991 / 2333361 * 100, 123478 / 2333361 * 100, 41030 / 2333361 * 100, 13556 / 2333361 * 100, 5153 / 2333361 * 100, 3567 / 2333361 * 100],
                    backgroundColor: 'RGBA(251, 141, 43, 1.00)',
                    borderColor: 'rgb(255,255,255)',
                    borderWidth: 1
                }, {
                    label: 'Average Population',
                    data: [7.9 / 85.3568 * 100, 33.5 / 85.3568 * 100 + 25.9, 10.4 / 85.3568 * 100, 4.6 / 85.3568 * 100, 1.9 / 85.3568 * 100, .6814 / 85.3568 * 100, .206 / 85.3568 * 100, .206 / 85.3568 * 100, .0634 / 85.3568 * 100],
                    backgroundColor: 'RGBA(0,0,0,0.2)',
                    borderColor: 'rgb(255,255,255)',
                    borderWidth: 1
                }, ]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            beginAtZero: true,
                        },
                        scaleLabel: {
                            display: true,
                            labelString: '% of Visitors',
                        }
                    }],
                    yAxes: [{
                        gridLines: {
                            offsetGridLines: false
                        },
                        ticks: {
                            maxRotation: 0,
                            autoSkip: false,
                            callback: function(value) {
                                return (value.substr(0, 10)); //truncate
                            },
                        }
                    }]
                },
                tooltips: {
                    enabled: true,
                    mode: 'label',
                    callbacks: {
                        title: function(tooltipItems, data) {
                            var idx = tooltipItems[0].index;
                            return data.labels[idx]; //do something with title
                        },
                    }
                },
                legend: {
                    display: true
                },
            }
        });

        //Footfall
        var ffBH = document.getElementById("homeRegion").getContext('2d');
        var ffByHr = new Chart(ffBH, {
            type: 'horizontalBar',
            data: {
                labels: [
                    'Delaware, US', 'Connecticut, US', 'Wisconsin, US', 'New Mexico, US', 'Michigan, US', 'Indiana, US', 'Idaho, US', 'Nebraska, US', 'Virginia, US', 'Maine, US', 'Illinois, US', 'Oklahoma, US', 'Alabama, US', 'Utah, US'
                ],
                datasets: [{
                    label: 'Arby\'s',
                    data: [1.508530792, 1.157753932, 1.149517111, 1.103867062, 1.068946753, 1.068175971, 1.064141645, 1.057895, 1.054326008, 1.045765286, 1.024412761, 1.020761541, 1.020336876, 1.016753694],
                    backgroundColor: 'rgba(255, 170, 34, 0.6)',
                    borderColor: 'rgb(255, 170, 34)',
                    borderWidth: 1
                }, ]
            },
            options: {
                scales: {
                    xAxes: [{
                        ticks: {
                            beginAtZero: true
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Over/under index',
                        }
                    }],
                    yAxes: [{
                        gridLines: {
                            offsetGridLines: false
                        },
                        ticks: {
                            maxRotation: 0,
                            autoSkip: false,
                            callback: function(value) {
                                return (value.substr(0, 20)); //truncate
                            },
                        }
                    }]
                },
                tooltips: {
                    enabled: true,
                    mode: 'label',
                    callbacks: {
                        title: function(tooltipItems, data) {
                            var idx = tooltipItems[0].index;
                            return data.labels[idx]; //do something with title
                        },
                    }
                },
                legend: {
                    display: false
                },
            }
        });

    </script>
</body>
