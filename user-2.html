<! DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Demo</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.44.0/mapbox-gl.css' rel='stylesheet' />
    <link href="style.css" rel="stylesheet" />
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.44.0/mapbox-gl.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
    <script src="Highmaps-6/code/highcharts.js"></script>
    <script src='Highmaps-6/code/js/modules/map.js'></script>
    <script src="Highmaps-6/code/modules/data.js"></script>
    <script src="https://code.highcharts.com/mapdata/countries/us/us-all.js"></script>
    <script src='jquery-3.3.1.js'></script>

    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://rawgit.com/FabricioRHS/skd3/master/build/sk.d3.min.js"></script>
    <link href="https://rawgit.com/FabricioRHS/skd3/master/build/sk.d3.min.css" rel="stylesheet" type="text/css" />

    <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script>
        var yellow = d3.interpolateYlGn(0), // "rgb(255, 255, 229)"
            yellowGreen = d3.interpolateYlGn(0.5), // "rgb(120, 197, 120)"
            green = d3.interpolateYlGn(1); // "rgb(0, 69, 41)"

    </script>

</head>

<body>
    <div id="factual">
        <img style="padding-left: 12px; padding-top: 8px; width: 25px;" src="Factual-color.png">
    </div>
    <div id="filters">
        <div style="position: absolute; left: 100px; top: 15px;">
            <img src="arbys.png" id="logo-small" class="small">
        </div>
        <div style="position: absolute; left: 160px; top: 5px;">
            <h2>Arby's</h2>
        </div>
        <div style="position: absolute; left: 280px; top: 10px; height: 70%; width: 2px; background-color: rgba(0,0,0,.05);"></div>
        <div style=" position: absolute; left: 300px; top: 14px;">
            <table>
                <tr>
                    <td style="font-size:.8em; font-weight: 700; padding-bottom: 4px;">Region</td>
                </tr>
                <tr>
                    <td>Los Angeles</td>
                    <td style="padding-left: 10px;"><a href="">x</a></td>
                </tr>
            </table>
        </div>

        <div style="position: absolute; right: 0; height: 70px; border: 2px solid RGBA(251, 141, 43, 1.00); box-sizing: border-box; padding: 27px 20px; cursor: pointer;">
            <b>BUY AUDIENCE</b>
        </div>
    </div>
    <div class="hero">
        <div id='map' style="width:100%; height: 800px;"></div>
        <div id='overlay'></div>
        <div id="overlay-content">
            <img src="arbys.png" id="logo">
            <div style="position: absolute; left: 30%; top: 34%;">
                <h1 style="font-size: 4em; text-transform: none; letter-spacing: 0px;">Arby's</h1>
                <p>Fast Food > American</p>
            </div>
            <div id="stats-1">
                <table>
                    <tr>
                        <td class="td1">5,796,862</td>
                        <td class="td1">#13</td>
                        <td class="td1">0.91%</td>
                    </tr>
                    <tr>
                        <td class="td2">Visitors Observed</td>
                        <td class="td2">Rank in Category</td>
                        <td class="td2">Category Visit Share</td>
                    </tr>
                </table>

            </div>
        </div>
    </div>
    <div id="userJourney">
        <div class="content">
            <div style="height: 160px;"></div>
            <a href="footfall-2.html"><h1 class="tabs">Footfall</h1></a>
            <a href="user-2.html"><h1 class="tabs active">User Journey</h1></a>
            <a href="demo-2.html"><h1 class="tabs">Demographics</h1></a>
            <a href="behavior-2.html"><h1 class="tabs">Behavior</h1></a>
            <div style="height: 60px;"></div>
            <div class="stats">
                <table style="width: 100%;">
                    <tr>
                        <th>Most Visited Before</th>
                        <th style="padding-left: 20px;">Most Visited After</th>
                        <th style="padding-left: 20px;">Likely to Visit Before</th>
                        <th style="padding-left: 20px; border-right: none;">Likely to Visit After</th>
                    </tr>
                    <tr>
                        <td style="border-right: 1px rgba(0,0,0,0.1) solid;">
                            <table class="td-table">
                                <tr>
                                    <td>Walgreens</td>

                                    <td>20.7%</td>
                                </tr>
                                <tr>
                                    <td>American</td>
                                    <td>61.5%</td>
                                </tr>
                            </table>
                        </td>
                        <td style="border-right: 1px rgba(0,0,0,0.1) solid; padding-left: 20px;">
                            <table class="td-table">
                                <tr>
                                    <td>Walgreens</td>

                                    <td>24.7%</td>
                                </tr>
                                <tr>
                                    <td>American</td>
                                    <td>67.2%</td>
                                </tr>
                            </table>
                        </td>

                        <td style="border-right: 1px rgba(0,0,0,0.1) solid; padding-left: 20px;">

                            <table class="td-table">
                                <tr>
                                    <td>Pilot Flying J</td>
                                    <td class="green">+267%</td>

                                </tr>
                                <tr>
                                    <td>Car Parts and ...</td>
                                    <td class="green">+77%</td>
                                </tr>
                            </table>

                        </td>
                        <td style=" padding-left: 20px;">
                            <table class="td-table">
                                <tr>
                                    <td>Pilot Flying J</td>
                                    <td class="green">+267%</td>
                                </tr>
                                <tr>
                                    <td>Car Parts and ...</td>

                                    <td class="green">+78%</td>
                                </tr>
                            </table>

                        </td>
                    </tr>
                </table>
            </div>
            <div style="height: 60px;"></div>
            <div style="width: 100%;">
                <div>
                    <div style="width: 45%; display: inline-block; vertical-align: top;">
                        <h2>Where do visitors go before?</h2>
                        <div>
                            <table>
                                <tr>
                                    <td class="percent">20.7%</td>
                                    <td class="subtext">of visitors come
                                        <br>from Walgreens before.</td>
                                </tr>
                            </table>

                        </div>
                        <br>
                        <canvas id="topChBefore" width="350" height="200"></canvas>
                    </div>
                    <div style="width: 5%; display:inline-block;"></div>
                    <div style="width: 45%; display: inline-block;">
                        <h2>Where do visitors go after?</h2>
                        <div>
                            <table>
                                <tr>
                                    <td class="percent">24.7%</td>
                                    <td class="subtext">of visitors go Walgreens after.
                                    </td>
                                </tr>
                            </table>

                        </div>
                        <br>
                        <canvas id="topChAfter" width="350" height="200"></canvas>
                    </div>
                </div>

                <div style="margin-top: 30px; margin-bottom: 80px;">
                    <div id='sankey'></div>
                </div>
                <hr style="opacity: 0.2;">
                <div style="margin-top: 80px;">
                    <div style="width: 45%; display: inline-block; vertical-align: top;">
                        <h2>More likely to visit before</h2>
                        <div>
                            <table>
                                <tr>
                                    <td class="percent green">+267%</td>
                                    <td class="subtext">more likely to come
                                        <br>from Pilot Flying J.
                                    </td>
                                </tr>
                            </table>

                        </div>
                        <br>
                        <canvas id="likelyChBefore" width="350" height="200"></canvas>
                    </div>
                    <div style="width: 5%; display:inline-block;"></div>
                    <div style="width: 45%; display: inline-block;">
                        <h2>More likely to visit after</h2>
                        <div>
                            <table>
                                <tr>
                                    <td class="percent green">+267%</td>
                                    <td class="subtext">more likely to visit
                                        <br>Pilot Flying J later.
                                    </td>
                                </tr>
                            </table>

                        </div>
                        <br>
                        <canvas id="likelyChAfter" width="350" height="200"></canvas>
                    </div>
                </div>
                <div style="margin-top: 30px; margin-bottom: 60px;">
                    <div id='sankey-2'></div>
                </div>
            </div>


        </div>


        <script>
            $(window).on("load", function() {
                console.log(window.scrollY);
                $('html, body').animate({
                    scrollTop: $('#userJourney').offset().top
                }, 'none');
                if (window.scrollY > 800) {
                    document.getElementById("filters").style.opacity = "1";
                } else {
                    document.getElementById("filters").style.opacity = "0";
                }
            });

            $(window).on("scroll", function() {
                console.log(window.scrollY);
                if (window.scrollY > 800) {
                    document.getElementById("filters").style.opacity = "1";
                } else {
                    document.getElementById("filters").style.opacity = "0";
                }
            });


            mapboxgl.accessToken = 'pk.eyJ1IjoibGF3cmVuY2UtZmFjdHVhbCIsImEiOiJjamQ2OWdseHQ0dHkxMndvMXh4cXF3c3g1In0.ycrRQ-DESrMwj6H_apu5Vw';
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v9',
                center: [-97.4954506496801, 39.248342470676164],
                zoom: 3.5,
                zoomControl: false,
                interactive: false,
            });

            //map.addControl(new mapboxgl.NavigationControl());

            var framesPerSecond = 600;
            var initialOpacity = 1
            var opacity = initialOpacity;
            var initialRadius = 8;
            var radius = initialRadius;
            var maxRadius = 18;

            map.on('load', function() {


                // Add a geojson point source.
                // Heatmap layers also work with a vector tile source.
                map.addSource('earthquakes', {
                    "type": "geojson",
                    "data": "earthquakes.geojson"
                });

                map.addLayer({
                    "id": "earthquakes-heat",
                    "type": "heatmap",
                    "source": "earthquakes",
                    "maxzoom": 9,
                    "paint": {
                        // Increase the heatmap weight based on frequency and property magnitude
                        "heatmap-weight": [
                            "interpolate", ["linear"],
                            ["get", "mag"],
                            0, 0,
                            6, 1
                        ],
                        // Increase the heatmap color weight weight by zoom level
                        // heatmap-intensity is a multiplier on top of heatmap-weight
                        "heatmap-intensity": [
                            "interpolate", ["linear"],
                            ["zoom"],
                            0, 1,
                            9, 3
                        ],
                        // Color ramp for heatmap.  Domain is 0 (low) to 1 (high).
                        // Begin color ramp at 0-stop with a 0-transparancy color
                        // to create a blur-like effect.
                        "heatmap-color": [
                            "interpolate", ["linear"],
                            ["heatmap-density"],
                            0, "rgba(248, 218, 125, .2)",
                            0.2, "rgba(248, 204, 125, .5)",
                            0.4, "rgba(255, 168, 95, 1)",
                            0.6, "rgb(253,219,199)",
                            0.8, "rgba(242, 146, 69, 1)",
                            1, "rgba(253, 127, 22, 1)"
                        ],
                        // Adjust the heatmap radius by zoom level
                        "heatmap-radius": [
                            "interpolate", ["linear"],
                            ["zoom"],
                            0, 2,
                            9, 20
                        ],
                        // Transition from heatmap to circle layer by zoom level
                        "heatmap-opacity": [
                            "interpolate", ["linear"],
                            ["zoom"],
                            7, 1,
                            9, 0
                        ],
                    }
                }, 'waterway-label');

                map.addLayer({
                    "id": "earthquakes-point",
                    "type": "circle",
                    "source": "earthquakes",
                    "minzoom": 7,
                    "paint": {
                        // Size circle radius by earthquake magnitude and zoom level
                        "circle-radius": [
                            "interpolate", ["linear"],
                            ["zoom"],
                            7, [
                                "interpolate", ["linear"],
                                ["get", "mag"],
                                1, 1,
                                6, 4
                            ],
                            16, [
                                "interpolate", ["linear"],
                                ["get", "mag"],
                                1, 5,
                                6, 50
                            ]
                        ],
                        // Color circle by earthquake magnitude
                        "circle-color": [
                            "interpolate", ["linear"],
                            ["get", "mag"],
                            1, "rgba(33,102,172,0)",
                            2, "rgba(248, 204, 125, .5)",
                            3, "rgba(255, 168, 95, 1)",
                            4, "rgb(253,219,199)",
                            5, "rgb(239,138,98)",
                            6, "rgb(178,24,43)"
                        ],
                        "circle-stroke-color": "white",
                        "circle-stroke-width": 1,
                        // Transition from heatmap to circle layer by zoom level
                        "circle-opacity": [
                            "interpolate", ["linear"],
                            ["zoom"],
                            7, 0,
                            8, 1
                        ]
                    }
                }, 'waterway-label');
                map.on('moveend', function() {
                    if ((map.getBounds().getNorthEast().lat < 34.997486284120924) && (map.getBounds().getNorthEast().lng < -115.53929752120165) && (map.getBounds().getSouthWest().lat > 32.57484297563741) && (map.getBounds().getSouthWest().lng > -121.09230695800564)) {
                        document.getElementById("reload").style.opacity = "1";
                    }

                });


                function animateMarker(timestamp) {
                    setTimeout(function() {
                        requestAnimationFrame(animateMarker);

                        radius += (maxRadius - radius) / framesPerSecond;
                        opacity -= (.9 / framesPerSecond);

                        map.setPaintProperty('earthquakes-heat', 'heatmap-radius', radius);
                        //map.setPaintProperty('earthquakes-heat', 'heatmap-opacity', opacity);
                        map.setPaintProperty('earthquakes-point', 'circle-radius', radius);
                        map.setPaintProperty('earthquakes-point', 'circle-opacity', opacity);

                        if (radius >= 10) {
                            radius = initialRadius;
                            opacity = initialOpacity;
                        }

                    }, 1000 / framesPerSecond);

                }

                // Start the animation.
                animateMarker(0);
            });



            //SANKEY SANKEY SANKEY
            var configSankey = {
                margin: {
                    top: 10,
                    left: 10,
                    right: 10,
                    bottom: 10
                },
                nodes: {
                    dynamicSizeFontNode: {
                        enabled: true,
                        minSize: 14,
                        maxSize: 30
                    },
                    draggableX: false,
                    draggableY: true,
                    colors: d3.scaleOrdinal(d3.schemeSet3),
                },
                links: {
                    formatValue: function(val) {
                        return d3.format(",.0f")(val);
                    }
                },
                tooltip: {
                    infoDiv: true,
                    labelSource: 'Input:',
                    labelTarget: 'Output:'
                }
            }

            var objSankey = {};
            d3.json("journey-2.json", function(error, energy) {
                if (error) throw error;
                objSankey = sk.createSankey('#sankey', configSankey, energy);
            });



            //Sankey
            var configSankey2 = {
                margin: {
                    top: 10,
                    left: 10,
                    right: 10,
                    bottom: 10
                },
                nodes: {
                    dynamicSizeFontNode: {
                        enabled: true,
                        minSize: 14,
                        maxSize: 30
                    },
                    draggableX: false,
                    draggableY: true,
                    colors: d3.scaleOrdinal(d3.schemeSet3),
                },
                links: {
                    formatValue: function(val) {
                        return d3.format(",.0f")(val);
                    }
                },
                tooltip: {
                    infoDiv: true,
                    labelSource: 'Input:',
                    labelTarget: 'Output:'
                }
            }

            var objSankey2 = {};
            d3.json("journey-2.json", function(error, energy) {
                if (error) throw error;
                objSankey = sk.createSankey('#sankey-2', configSankey, energy);
            });

            //Top Chains Before
            var chB = document.getElementById("topChBefore").getContext('2d');
            var chBef = new Chart(chB, {
                type: 'horizontalBar',
                data: {
                    labels: [
                        "Hardee\'s", "Marathon", "Waffle House", "Ace Hardware", "Big Lots", "O'Reilly Auto Parts", "Advance Auto Parts", "Sam\'s Club", "Lowe\'s", "PNC Bank", "Office Depot", "Wendy\'s", "Applebee\'s", "Sonic Drive-In", "Pizza Hut"
                    ],
                    datasets: [{
                        label: 'Arby\'s',
                        data: [3.568765368, 3.460864808, 2.984353028, 2.348793673, 2.320158424, 2.211037721, 2.14873184, 2.1283209, 2.127029078, 2.045917195, 1.953643826, 1.91754947, 1.877432302, 1.856581094, 1.842628348],
                        backgroundColor: 'rgba(255, 170, 34, 0.6)',
                        borderColor: 'rgb(255, 170, 34)',
                        borderWidth: 1
                    }, ]
                },
                options: {
                    scales: {
                        xAxes: [{
                            ticks: {
                                beginAtZero: true
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Over/under index',
                            }
                        }],
                        yAxes: [{
                            gridLines: {
                                offsetGridLines: false
                            },
                            ticks: {
                                maxRotation: 0,
                                autoSkip: false,
                                callback: function(value) {
                                    return (value.substr(0, 12) + '..'); //truncate
                                },
                            }
                        }]
                    },
                    tooltips: {
                        enabled: true,
                        mode: 'label',
                        callbacks: {
                            title: function(tooltipItems, data) {
                                var idx = tooltipItems[0].index;
                                return data.labels[idx]; //do something with title
                            },
                        }
                    },
                    legend: {
                        display: false
                    },
                }
            });

            //Chains After
            var chA = document.getElementById("topChAfter").getContext('2d');
            var chAf = new Chart(chA, {
                type: 'horizontalBar',
                data: {
                    labels: [
                        "Marathon", "Anytime Fitness", "Little Caesars Pizza", "Lowe\'s", "Ace Hardware", "Wendy\'s", "Taco Bell", "Papa John\'s Pizza", "KFC", "Dairy Queen", "Kmart", "Jimmy John\'s", "Big Lots", "Walgreens", "Olive Garden"
                    ],
                    datasets: [{
                        label: 'Arby\'s',
                        data: [3.476114675, 2.557296936, 2.201125458, 2.193753305, 2.191820875, 2.186016682, 2.133703359, 2.092429566, 2.08120885, 2.028042692, 2.005494282, 1.989803704, 1.950902318, 1.905283144, 1.855765041],
                        backgroundColor: 'rgba(255, 170, 34, 0.6)',
                        borderColor: 'rgb(255, 170, 34)',
                        borderWidth: 1
                    }, ]
                },
                options: {
                    scales: {
                        xAxes: [{
                            ticks: {
                                beginAtZero: true
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Over/under index',
                            }
                        }],
                        yAxes: [{
                            gridLines: {
                                offsetGridLines: false
                            },
                            ticks: {
                                maxRotation: 0,
                                autoSkip: false,
                                callback: function(value) {
                                    return (value.substr(0, 12) + '..'); //truncate
                                },
                            }
                        }]
                    },
                    tooltips: {
                        enabled: true,
                        mode: 'label',
                        callbacks: {
                            title: function(tooltipItems, data) {
                                var idx = tooltipItems[0].index;
                                return data.labels[idx]; //do something with title
                            },
                        }
                    },
                    legend: {
                        display: false
                    },
                }
            });

            //Likely Chains Before
            var chB = document.getElementById("likelyChBefore").getContext('2d');
            var chBef = new Chart(chB, {
                type: 'horizontalBar',
                data: {
                    labels: [
                        "Hardee\'s", "Marathon", "Waffle House", "Ace Hardware", "Big Lots", "O'Reilly Auto Parts", "Advance Auto Parts", "Sam\'s Club", "Lowe\'s", "PNC Bank", "Office Depot", "Wendy\'s", "Applebee\'s", "Sonic Drive-In", "Pizza Hut"
                    ],
                    datasets: [{
                        label: 'Arby\'s',
                        data: [3.568765368, 3.460864808, 2.984353028, 2.348793673, 2.320158424, 2.211037721, 2.14873184, 2.1283209, 2.127029078, 2.045917195, 1.953643826, 1.91754947, 1.877432302, 1.856581094, 1.842628348],
                        backgroundColor: 'rgba(255, 170, 34, 0.6)',
                        borderColor: 'rgb(255, 170, 34)',
                        borderWidth: 1
                    }, ]
                },
                options: {
                    scales: {
                        xAxes: [{
                            ticks: {
                                beginAtZero: true
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Over/under index',
                            }
                        }],
                        yAxes: [{
                            gridLines: {
                                offsetGridLines: false
                            },
                            ticks: {
                                maxRotation: 0,
                                autoSkip: false,
                                callback: function(value) {
                                    return (value.substr(0, 12) + '..'); //truncate
                                },
                            }
                        }]
                    },
                    tooltips: {
                        enabled: true,
                        mode: 'label',
                        callbacks: {
                            title: function(tooltipItems, data) {
                                var idx = tooltipItems[0].index;
                                return data.labels[idx]; //do something with title
                            },
                        }
                    },
                    legend: {
                        display: false
                    },
                }
            });

            //Likely Chains After
            var chA = document.getElementById("likelyChAfter").getContext('2d');
            var chAf = new Chart(chA, {
                type: 'horizontalBar',
                data: {
                    labels: [
                        "Marathon", "Anytime Fitness", "Little Caesars Pizza", "Lowe\'s", "Ace Hardware", "Wendy\'s", "Taco Bell", "Papa John\'s Pizza", "KFC", "Dairy Queen", "Kmart", "Jimmy John\'s", "Big Lots", "Walgreens", "Olive Garden"
                    ],
                    datasets: [{
                        label: 'Arby\'s',
                        data: [3.476114675, 2.557296936, 2.201125458, 2.193753305, 2.191820875, 2.186016682, 2.133703359, 2.092429566, 2.08120885, 2.028042692, 2.005494282, 1.989803704, 1.950902318, 1.905283144, 1.855765041],
                        backgroundColor: 'rgba(255, 170, 34, 0.6)',
                        borderColor: 'rgb(255, 170, 34)',
                        borderWidth: 1
                    }, ]
                },
                options: {
                    scales: {
                        xAxes: [{
                            ticks: {
                                beginAtZero: true
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Over/under index',
                            }
                        }],
                        yAxes: [{
                            gridLines: {
                                offsetGridLines: false
                            },
                            ticks: {
                                maxRotation: 0,
                                autoSkip: false,
                                callback: function(value) {
                                    return (value.substr(0, 12) + '..'); //truncate
                                },
                            }
                        }]
                    },
                    tooltips: {
                        enabled: true,
                        mode: 'label',
                        callbacks: {
                            title: function(tooltipItems, data) {
                                var idx = tooltipItems[0].index;
                                return data.labels[idx]; //do something with title
                            },
                        }
                    },
                    legend: {
                        display: false
                    },
                }
            });

        </script>
</body>
